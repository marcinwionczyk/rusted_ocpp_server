<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OCPP Server web client</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css"
          integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"
            integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js"></script>
</head>
<body>
<div class="container">
    <div class="header clearfix">
        <h3 class="text-muted">OCPP Server web client</h3>
    </div>
    <hr>
    <div class="row marketing">
        <div class="col-lg-5">
            <form method="post" action="/cancel-reservation"></form>
            <div id="res" class="alert"></div>
        </div>
        <div class="col-lg-7">
            <div class="form-group">
                <label for="ServerLog">Server Log:</label>
                <textarea id="ServerLog" class="form-control font-weight-light" rows="35" style="resize: none"
                          wrap="soft" readonly></textarea>
            </div>
        </div>
    </div>
    <footer class="blockquote-footer">
        <p>&copy; ABB Company 2021</p>
    </footer>
</div>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
<script type="text/javascript" src="https://unpkg.com/JSV@4.0.2/lib/jsv.js"></script>
<script type="text/javascript" src="https://unpkg.com/jsonform@2.2.1/lib/jsonform.js"></script>
<script type="text/javascript">

    (function () {
        const logger = document.getElementById('ServerLog');
        console.log = function (message) {
            if (typeof message == 'object') {
                logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(message) : message) + '\n';
            } else {
                logger.innerHTML += message + '\n';
            }
        }
    })();

    const today_date = luxon.DateTime.now();
    const yesterday_date = today_date.minus({days: 1});
    const tomorrow_date = today_date.plus({days: 1});
    const today_string = today_date.toFormat("yyyy-MM-dd'T'TT");
    const yesterday_string = yesterday_date.toFormat("yyyy-MM-dd'T'TT");
    const tomorrow_string = tomorrow_date.toFormat("yyyy-MM-dd'T'TT");

    $('form').jsonForm(
        {
            schema: {
                charge_point: {
                    type: 'string',
                    //enum: [ {{ #each available_chargers }} '{{ this.serial_id }}', {{ /each }} ]
                },
                choice: {
                    type: "string",
                    enum: ['cancel_reservation', 'change_availability', 'change_configuration', 'clear_cache',
                        'clear_charging_profile', 'data_transfer', 'get_composite_schedule', 'get_configuration',
                        'get_diagnostics', 'get_local_list_version', 'remote_start_transaction',
                        'remote_stop_transaction', 'reserve_now', 'reset', 'send_local_list', 'set_charging_profile',
                        'trigger_message', 'unlock_connector', 'update_firmware_request', 'certificate_signed',
                        'delete_certificate', 'extended_trigger_message', 'get_installed_certificate_ids', 'get_log',
                        'install_certificate', 'signed_firmware_update']
                },
                cancel_reservation: {
                    type: "object",
                    title: "Cancel reservation request",
                    properties: {
                        reservationId: {
                            type: 'integer',
                            title: 'reservationId'
                        }
                    }
                },
                change_availability: {
                    type: 'object',
                    title: 'Change availability request',
                    properties: {
                        connectorId: {
                            type: 'integer',
                            title: 'connectorId',
                            required: true
                        },
                        type: {
                            type: 'string',
                            title: 'type',
                            enum: ['Inoperative', 'Operative'],
                            required: true
                        }
                    }
                },
                change_configuration: {
                    type: 'object',
                    title: "Change configuration request",
                    properties: {
                        key: {
                            type: 'string',
                            title: 'key',
                            maxLength: 50,
                            required: true
                        },
                        value: {
                            type: 'string',
                            title: 'value',
                            maxLength: 500,
                            required: true
                        }
                    }
                },
                clear_cache: {
                    type: "object",
                    title: "Clear cache",
                    properties: {}
                },
                clear_charging_profile: {
                    type: "object",
                    title: "Clear charging profile",
                    properties: {
                        id: {
                            title: 'id',
                            type: 'integer',
                        },
                        connectorId: {
                            title: 'connectorId',
                            type: 'integer'
                        },
                        chargingProfilePurpose: {
                            title: 'chargingProfilePurpose',
                            type: 'string',
                            enum: ["ChargePointMaxProfile", "TxDefaultProfile", "TxProfile"]
                        },
                        stackLevel: {
                            title: 'stackLevel',
                            type: 'integer'
                        }
                    }
                },
                data_transfer: {
                    type: "object",
                    title: "data transfer",
                    properties: {
                        vendorId: {
                            type: "string",
                            title: 'vendorId',
                            maxLength: 255,
                            required: true
                        },
                        messageId: {
                            type: "string",
                            title: 'messageId',
                            maxLength: 50
                        },
                        data: {
                            type: "string",
                            title: "data"
                        }
                    }
                },
                get_composite_schedule: {
                    type: "object",
                    title: "GetCompositeSchedule",
                    properties: {
                        connectorId: {
                            type: 'integer',
                            title: 'connectorId',
                            required: true
                        },
                        duration: {
                            type: 'integer',
                            title: 'duration',
                            required: true
                        },
                        chargingRateUnit: {
                            type: 'string',
                            title: 'chargingRateUnit',
                            enum: ['A', 'W']
                        }
                    }
                },
                get_configuration: {
                    type: "object",
                    title: "GetConfiguration",
                    properties: {
                        key: {
                            type: 'array',
                            title: 'keys',
                            items: {
                                type: 'string',
                                title: 'key {{ idx }}',
                                maxLength: 50
                            }
                        }
                    }
                },
                get_diagnostics: {
                    type: 'object',
                    title: "GetDiagnostics",
                    properties: {
                        location: {
                            type: "string",
                            title: "location",
                            format: "uri",
                            required: true
                        },
                        retries: {
                            title: "retires",
                            type: "integer"
                        },
                        retryInterval: {
                            title: "retryInterval",
                            type: "integer"
                        },
                        startTime: {
                            type: "datetime-local",
                            title: "startTime",
                            format: "datetime",
                            description: 'date in ISO format',
                            default: yesterday_string
                        },
                        stopTime: {
                            type: "datetime-local",
                            title: "stopTime",
                            format: "datetime",
                            description: "datetime in ISO format",
                            default: today_string
                        }
                    }
                },
                get_local_list_version: {
                    type: 'object',
                    title: "GetLocalListVersion",
                    properties: {}
                },
                remote_start_transaction: {
                    type: 'object',
                    title: 'RemoteStartTransaction',
                    properties: {
                        connectorId: {
                            type: "integer",
                            title: "connectorId"
                        },
                        idTag: {
                            title: "idTag",
                            type: "string",
                            maxLength: 20,
                            required: true,
                        },
                        chargingProfile: {
                            type: 'object',
                            title: "chargingProfile",
                            properties: {
                                chargingProfileId: {
                                    title: "chargingProfileId",
                                    type: 'integer',
                                    required: true
                                },
                                transactionId: {
                                    title: "transactionId",
                                    type: 'integer'
                                },
                                stackLevel: {
                                    title: "stackLevel",
                                    type: 'integer',
                                    required: true
                                },
                                chargingProfilePurpose: {
                                    title: "chargingProfilePurpose",
                                    type: 'string',
                                    enum: ["ChargePointMaxProfile", "TxDefaultProfile", "TxProfile"],
                                    required: true
                                },
                                chargingProfileKind: {
                                    title: "chargingProfileKind",
                                    type: 'string',
                                    enum: ["Absolute", "Recurring", "Relative"],
                                    required: true
                                },
                                recurrencyKind: {
                                    title: "recurrencyKind",
                                    type: 'string',
                                    enum: ["Daily", "Weekly"]
                                },
                                validFrom: {
                                    title: "validFrom",
                                    type: "datetime-local",
                                    default: yesterday_string,
                                    description: "datetime in ISO format",
                                },
                                validTo: {
                                    title: "validTo",
                                    type: "datetime-local",
                                    default: today_string,
                                    description: "datetime in ISO format",
                                },
                                chargingSchedule: {
                                    type: 'object',
                                    title: 'chargingSchedule',
                                    required: true,
                                    properties: {
                                        duration: {
                                            title: "duration",
                                            type: "integer"
                                        },
                                        startSchedule: {
                                            title: "startSchedule",
                                            type: "datetime-local",
                                            format: "datetime",
                                            default: yesterday_string,
                                            description: "datetime in ISO format",
                                        },
                                        chargingRateUnit: {
                                            title: "chargingRateUnit",
                                            type: "string",
                                            enum: ["A", "W"],
                                            required: true
                                        },
                                        chargingSchedulePeriod: {
                                            required: true,
                                            title: "chargingSchedulePeriod",
                                            type: "array",
                                            items: {
                                                type: "object",
                                                title: "items",
                                                properties: {
                                                    startPeriod: {
                                                        title: "startPeriod",
                                                        type: "integer",
                                                        required: true
                                                    },
                                                    limit: {
                                                        title: "limit",
                                                        type: "number",
                                                        description: "number divisible by 0.1",
                                                        divisibleBy: 0.1,
                                                        required: true
                                                    },
                                                    numberPhases: {
                                                        title: "numberPhases",
                                                        type: "integer"
                                                    }
                                                }
                                            }
                                        },
                                        minChargingRate: {
                                            title: "minChargingRate",
                                            type: "number",
                                            description: "number divisible by 0.1",
                                            divisibleBy: 0.1,
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                remote_stop_transaction: {
                    title: "RemoteStopTransaction",
                    type: "object",
                    properties: {
                        transactionId: {
                            title: 'transactionId',
                            type: "integer",
                            required: true
                        }
                    }
                },
                reserve_now: {
                    title: "reserveNow",
                    type: "object",
                    properties: {
                        connectorId: {
                            title: "connectorId",
                            type: "integer",
                            required: true
                        },
                        expiryDate: {
                            title: "expiryDate",
                            type: "datetime-local",
                            required: true,
                            default: today_string,
                            description: "datetime in ISO format",
                        },
                        idTag: {
                            title: "idTag",
                            type: "string",
                            maxLength: 20,
                            required: true
                        },
                        parentIdTag: {
                            title: "parentIdTag",
                            type: "string",
                            maxLength: 20
                        },
                        reservationId: {
                            title: "reservationId",
                            type: "integer",
                            required: true
                        }
                    }
                },
                reset: {
                    title: "Reset",
                    type: "object",
                    properties: {
                        type: {
                            title: "type",
                            type: "string",
                            enum: ["Hard", "Soft"],
                            required: true
                        }
                    }
                },
                send_local_list: {
                    title: "SendLocalList",
                    type: "object",
                    properties: {
                        listVersion: {
                            type: "integer",
                            title: "listVersion",
                            required: true
                        },
                        localAuthorizationList: {
                            title: "localAuthorizationList",
                            type: "array",
                            items: {
                                type: "object",
                                properties: {
                                    idTag: {
                                        type: "string",
                                        title: "idTag",
                                        maxLength: 20,
                                        required: true
                                    },
                                    idTagInfo: {
                                        type: "object",
                                        title: "idTagInfo",
                                        properties: {
                                            expiryDate: {
                                                title: "expiryDate",
                                                type: "datetime-local",
                                                default: today_string,
                                                description: "datetime in ISO format",
                                            },
                                            parentIdTag: {
                                                title: "parentIdTag",
                                                type: "string",
                                                maxLength: 20
                                            },
                                            status: {
                                                title: "status",
                                                type: "string",
                                                enum: ["Accepted", "Blocked", "Expired", "Invalid", "ConcurrentTx"],
                                                required: true
                                            }
                                        }
                                    }

                                }
                            }
                        },
                        updateType: {
                            title: "updateType",
                            type: "string",
                            enum: ["Differential", "Full"],
                            required: true
                        }

                    }
                },
                set_charging_profile: {
                    title: "SetChargingProfile",
                    type: "object",
                    properties: {
                        connectorId: {
                            title: "connectorId",
                            type: "integer",
                            required: true
                        },
                        csChargingProfiles: {
                            title: "csChargingProfiles",
                            type: "object",
                            required: true,
                            properties: {
                                chargingProfileId: {
                                    title: "chargingProfileId",
                                    type: "integer",
                                    required: true
                                },
                                transactionId: {
                                    title: "transactionId",
                                    type: "integer",
                                },
                                stackLevel: {
                                    title: "stackLevel",
                                    type: "integer",
                                    required: true
                                },
                                chargingProfilePurpose: {
                                    title: "chargingProfilePurpose",
                                    type: "string",
                                    enum: ["ChargePointMaxProfile", "TxDefaultProfile", "TxProfile"],
                                    required: true
                                },
                                chargingProfileKind: {
                                    title: "chargingProfileKind",
                                    type: "string",
                                    enum: ["Absolute", "Recurring", "Relative"],
                                    required: true
                                },
                                recurrencyKind: {
                                    title: "recurrencyKind",
                                    type: "string",
                                    enum: ["Daily", "Weekly"]
                                },
                                validFrom: {
                                    title: "validFrom",
                                    type: "datetime-local",
                                    format: "datetime",
                                    default: today_string,
                                    description: "datetime in ISO format",
                                },
                                validTo: {
                                    title: "validTo",
                                    type: "datetime-local",
                                    format: "datetime",
                                    default: tomorrow_string,
                                    description: "datetime in ISO format",
                                },
                                chargingSchedule: {
                                    title: "ChargingSchedule",
                                    type: "object",
                                    required: true,
                                    properties: {
                                        duration: {
                                            title: "duration",
                                            type: "integer"
                                        },
                                        startSchedule: {
                                            title: 'startSchedule',
                                            type: "datetime-local",
                                            format: "datetime",
                                            default: today_string,
                                            description: "datetime in ISO format",
                                        },
                                        chargingRateUnit: {
                                            title: "chargingRateUnit",
                                            type: "string",
                                            enum: ["A", "W"],
                                            required: true
                                        },
                                        chargingSchedulePeriod: {
                                            title: "chargingSchedulePeriod",
                                            type: "array",
                                            required: true,
                                            minItems: 1,
                                            items: {
                                                type: "object",
                                                properties: {
                                                    startPeriod: {
                                                        title: "startPeriod",
                                                        type: "integer",
                                                        required: true
                                                    },
                                                    limit: {
                                                        title: "limit",
                                                        type: "number",
                                                        description: "number divisible by 0.1",
                                                        divisibleBy: 0.1,
                                                        required: true
                                                    },
                                                    numberPhases: {
                                                        title: "numberPhases",
                                                        type: "integer"
                                                    }
                                                }
                                            }
                                        },
                                        minChargingRate: {
                                            title: "minChargingRate",
                                            type: "number",
                                            divisibleBy: 0.1,
                                            description: "number divisible by 0.1",
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                trigger_message: {
                    title: "TriggerMessage",
                    type: "object",
                    properties: {
                        requestedMessage: {
                            title: "requestedMessage",
                            type: "string",
                            enum: ["BootNotification", "DiagnosticsStatusNotification", "FirmwareStatusNotification",
                                "Heartbeat", "MeterValues", "StatusNotification"],
                            required: true
                        },
                        connectorId: {
                            title: "connectorId",
                            type: "integer"
                        }
                    }
                },
                unlock_connector: {
                    title: "UnlockConnector",
                    type: "object",
                    properties: {
                        connectorId: {
                            title: "connectorId",
                            type: "integer",
                            required: true
                        }
                    }
                },
                update_firmware_request: {
                    title: "UpdateFirmwareRequest",
                    type: "object",
                    properties: {
                        location: {
                            title: "location",
                            type: "url",
                            format: "url",
                            required: true
                        },
                        retries: {
                            title: "retries",
                            type: "integer",
                        },
                        retrieveDate: {
                            title: "retrieveDate",
                            type: "datetime-local",
                            format: "datetime",
                            default: today_string,
                            description: "datetime in ISO format",
                            required: true
                        },
                        retryInterval: {
                            title: "retryInterval",
                            type: "integer",
                        }
                    }
                },
                certificate_signed: {
                    title: "CertificateSigned",
                    type: "object",
                    properties: {
                        certificateChain: {
                            title: "certificateChain",
                            type: "string",
                            maxLength: 10000,
                            required: true
                        }
                    }
                },
                delete_certificate: {
                    title: "DeleteCertificate",
                    type: "object",
                    properties: {
                        certificateHashData: {
                            title: "certificateHashData",
                            type: "object",
                            required: true,
                            properties: {
                                hashAlgorithm: {
                                    title: "hashAlgorithm",
                                    type: "string",
                                    enum: ["SHA256", "SHA384", "SHA512"],
                                    required: true
                                },
                                issuerNameHash: {
                                    title: "issuerNameHash",
                                    type: "string",
                                    maxLength: 128,
                                    required: true
                                },
                                issuerKeyHash: {
                                    title: "issuerKeyHash",
                                    type: "string",
                                    maxLength: 128,
                                    required: true
                                },
                                serialNumber: {
                                    title: "serialNumber",
                                    type: "string",
                                    maxLength: 40,
                                    required: true
                                }
                            }
                        }
                    }
                },
                extended_trigger_message: {
                    title: "ExtendedTriggerMessage",
                    type: "object",
                    properties: {
                        requestedMessage: {
                            title: "requestedMessage",
                            type: "string",
                            required: true,
                            enum: ["BootNotification", "LogStatusNotification", "FirmwareStatusNotification", "Heartbeat",
                                "MeterValues", "SignChargePointCertificate", "StatusNotification"]
                        },
                        connectorId: {
                            title: "connectorId",
                            type: "integer"
                        }
                    }
                },
                get_installed_certificate_ids: {
                    title: "GetInstalledCertificateIds",
                    type: "object",
                    properties: {
                        certificateType: {
                            title: "certificateType",
                            type: "string",
                            enum: ["CentralSystemRootCertificate", "ManufacturerRootCertificate"],
                            required: true
                        }
                    }
                },
                get_log: {
                    title: "GetLog",
                    type: "object",
                    properties: {
                        log: {
                            title: "log",
                            type: "object",
                            required: true,
                            properties: {
                                remoteLocation: {
                                    title: "remoteLocation",
                                    type: "string",
                                    maxLength: 512,
                                    required: true
                                },
                                oldestTimestamp: {
                                    title: "oldestTimestamp",
                                    type: "datetime-local",
                                    format: "datetime",
                                    default: yesterday_string,
                                    description: "datetime in ISO format"
                                },
                                latestTimestamp: {
                                    title: "latestTimestamp",
                                    type: "datetime-local",
                                    format: "datetime",
                                    default: today_string,
                                    description: "datetime in ISO format"
                                }
                            }
                        },
                        logType: {
                            title: "logType",
                            type: "string",
                            required: true,
                            enum: ["DiagnosticsLog", "SecurityLog"]
                        },
                        requestId: {
                            title: "requestId",
                            type: "integer",
                            required: true
                        },
                        retries: {
                            title: "retries",
                            type: "integer"
                        },
                        retryInterval: {
                            title: "retryInterval",
                            type: "integer"
                        }
                    }
                },
                install_certificate: {
                    title: "InstallCertificate",
                    type: "object",
                    properties: {
                        certificateType: {
                            title: "certificateType",
                            type: "string",
                            required: true,
                            enum: ["CentralSystemRootCertificate", "ManufacturerRootCertificate"]
                        },
                        certificate: {
                            type: "string",
                            title: "certificate",
                            maxLength: 5500,
                            required: true
                        }
                    }
                },
                signed_firmware_update: {
                    title: "SignedFirmwareUpdate",
                    type: "object",
                    properties: {
                        retries: {
                            title: "retries",
                            type: "integer"
                        },
                        retryInterval: {
                            title: "retryInterval",
                            type: "integer"
                        },
                        requestId: {
                            title: "requestId",
                            type: "integer",
                            required: true
                        },
                        firmware: {
                            title: "firmware",
                            type: "object",
                            properties: {
                                location: {
                                    title: "location",
                                    type: "string",
                                    maxLength: 512,
                                    required: true
                                },
                                retrieveDateTime: {
                                    title: "retrieveDateTime",
                                    type: "datetime-local",
                                    format: "datetime",
                                    default: today_string,
                                    required: true,
                                    description: "datetime in ISO format"
                                },
                                installDateTime: {
                                    title: "installDateTime",
                                    type: "datetime-local",
                                    format: "datetime",
                                    default: tomorrow_string,
                                    description: "datetime in ISO format"
                                },
                                signingCertificate: {
                                    title: "signingCertificate",
                                    type: "string",
                                    required: true,
                                    maxLength: 5500
                                },
                                signature: {
                                    title: "signature",
                                    type: "string",
                                    required: true,
                                    maxLength: 800
                                }
                            }
                        }
                    }
                }
            },
            "form":
                [
                    {
                        "key": "charge_point",
                        "title": "Select Charge Point by serial ID"
                    },
                    {
                        "type": "selectfieldset",
                        "key": "choice",
                        "title": "Select request",
                        "titleMap": {
                            "cancel_reservation": "CancelReservation",
                            "change_availability": "ChangeAvailability",
                            "change_configuration": "ChangeConfiguration",
                            "clear_cache": "ClearCache",
                            "clear_charging_profile": "ClearChargingProfile",
                            "data_transfer": "DataTransfer",
                            'get_composite_schedule': "GetCompositeSchedule",
                            'get_configuration': "GetConfiguration",
                            'get_diagnostics': "GetDiagnostics",
                            'get_local_list_version': "GetLocalListVersion",
                            'remote_start_transaction': "RemoteStartTransaction",
                            'remote_stop_transaction': "RemoteStopTransaction",
                            'reserve_now': "ReserveNow",
                            'reset': "Reset",
                            'send_local_list': "SendLocalList",
                            'set_charging_profile': "SetChargingProfile",
                            'trigger_message': "TriggerMessage",
                            'unlock_connector': "UnlockConnector",
                            'update_firmware_request': "UpdateFirmwareRequest",
                            'certificate_signed': "CertificateSigned",
                            'delete_certificate': "DeleteCertificate",
                            'extended_trigger_message': "ExtendedTriggerMessage",
                            'get_installed_certificate_ids': "GetInstalledCertificateIds",
                            'get_log': "GetLog",
                            'install_certificate': "InstallCertificate",
                            'signed_firmware_update': "SignedFirmwareUpdate"
                        },
                        "items": [
                            "cancel_reservation",
                            "change_availability",
                            "change_configuration",
                            "clear_cache",
                            "clear_charging_profile",
                            "data_transfer",
                            'get_composite_schedule',
                            'get_configuration',
                            'get_diagnostics',
                            'get_local_list_version',
                            'remote_start_transaction',
                            'remote_stop_transaction',
                            'reserve_now',
                            'reset',
                            'send_local_list',
                            'set_charging_profile',
                            'trigger_message',
                            'unlock_connector',
                            'update_firmware_request',
                            'certificate_signed',
                            'delete_certificate',
                            'extended_trigger_message',
                            'get_installed_certificate_ids',
                            'get_log',
                            'install_certificate',
                            'signed_firmware_update'
                        ]
                    },
                    {
                        "type": "submit",
                        "value": "Submit"
                    }
                ]
        });
</script>
</body>
</html>